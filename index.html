<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Termux Elking Real</title>
    
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlRlcm11eCBFbGFraW5nIiwKICAic2hvcnRfbmFtZSI6ICJFbGtpbmdUZXJtIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJ0aGVtZV9jb2xvciI6ICIjMDAwMDAwIiwKICAiaWNvbnMiOiBbIHsgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi85MjAvOTIwNTMzLnBuZyIsICJzaXplcyI6ICI1MTJ4NTEyIiwgInR5cGUiOiAiaW1hZ2UvcG5nIiB9IF0KfQ==">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');

        :root {
            --bg-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?auto=format&fit=crop&w=1080&q=80');
            --text-color: #e0e0e0;
            --prompt-color: #00ff41; /* Verde Termux */
            --dir-color: #00bfff; /* Cartelle blu */
            --font-size: 13px;
        }

        body {
            margin: 0;
            background: #000 var(--bg-image) center/cover fixed no-repeat;
            color: var(--text-color);
            font-family: 'Fira Code', 'Courier New', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Overlay scuro per leggere meglio il testo sopra lo sfondo */
        #terminal-overlay {
            flex: 1;
            background: rgba(10, 10, 15, 0.92); 
            padding: 8px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            font-size: var(--font-size);
            line-height: 1.3;
        }

        .output-line {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 2px;
        }

        .prompt-line {
            display: flex;
            align-items: center;
        }

        .prompt-text {
            color: var(--prompt-color);
            font-weight: bold;
            white-space: nowrap;
            margin-right: 5px;
        }

        input {
            background: transparent;
            border: none;
            color: white;
            font-family: inherit;
            font-size: inherit;
            flex-grow: 1;
            outline: none;
            padding: 0;
            margin: 0;
        }

        /* Toolbar stile Termux */
        #extra-keys {
            background: #212121;
            display: flex;
            padding: 4px;
            gap: 4px;
            overflow-x: auto;
            flex-shrink: 0;
            border-top: 1px solid #333;
        }

        .key {
            background: #424242;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 2px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
        .key:active { background: #616161; }

        /* Helpers per colori testo */
        .blue { color: #5ea1ff; font-weight: bold; }
        .green { color: #00ff41; }
        .red { color: #ff5555; }
        
    </style>
</head>
<body>

    <div id="terminal-overlay" onclick="focusInput()">
        <div id="output">
            <div class="output-line">Welcome to Termux!</div>
            <div class="output-line">Wiki:     https://wiki.termux.com</div>
            <div class="output-line">Community: https://termux.com/community</div>
            <div class="output-line">Gitter:    https://gitter.im/termux/termux</div>
            <div class="output-line">IRC:       #termux on freenode</div>
            <br>
            <div class="output-line">Working with packages:</div>
            <div class="output-line"> * search packages:   pkg search &lt;query&gt;</div>
            <div class="output-line"> * install a package: pkg install &lt;package&gt;</div>
            <div class="output-line"> * upgrade packages:  pkg upgrade</div>
            <br>
        </div>
        
        <div class="prompt-line" id="input-line">
            <span class="prompt-text" id="prompt-label">H4CK3R[~]:#</span>
            <input type="text" id="cmd-input" autocomplete="off" spellcheck="false" autofocus>
        </div>
    </div>

    <div id="extra-keys">
        <button class="key" onclick="insert('ESC')">ESC</button>
        <button class="key" onclick="insert('/')">/</button>
        <button class="key" onclick="insert('-')">-</button>
        <button class="key" onclick="insert('HOME')">HOME</button>
        <button class="key" onclick="insert('UP')">⬆</button>
        <button class="key" onclick="insert('END')">END</button>
        <button class="key" style="color:#00ffff" onclick="zoom(1)">Z+</button>
        <button class="key" style="color:#00ffff" onclick="zoom(-1)">Z-</button>
    </div>

    <script>
        // --- SISTEMA E STATO ---
        const outputDiv = document.getElementById('output');
        const input = document.getElementById('cmd-input');
        const promptLabel = document.getElementById('prompt-label');
        const root = document.documentElement;

        // File System Virtuale
        let currentDir = "~"; 
        let fileSystem = {
            "~": ["downloads", "storage", "test_file.txt"],
            "~/downloads": [],
            "~/storage": []
        };
        
        // Stato interattivo (per y/n questions)
        let interactiveState = null; 

        // Zoom
        let currentZoom = 13;

        // --- GESTIONE INPUT ---
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const rawInput = input.value;
                const cleanInput = rawInput.trim();
                
                // Stampa la riga di comando appena eseguita
                printToScreen(`${promptLabel.innerText} ${rawInput}`);
                
                // Pulisci input
                input.value = '';

                // Se siamo in modalità interattiva (es. termux-setup-storage)
                if (interactiveState) {
                    handleInteractive(cleanInput);
                } else {
                    // Modalità normale
                    if (cleanInput !== "") executeCommand(cleanInput);
                }
                
                scrollToBottom();
            }
        });

        // --- MOTORE COMANDI ---
        async function executeCommand(cmdStr) {
            const args = cmdStr.split(/\s+/); // Divide per spazi
            const cmd = args[0];

            switch (cmd) {
                case 'pkg':
                    if (!args[1]) {
                        // Replica esatta del testo richiesto
                        printToScreen(`Usage: pkg command [arguments]

A tool for managing apt packages.

Commands:

  autoclean            - Remove all outdated packages from apt cache.

  clean                - Remove all packages from apt cache.
                         Using 16M now.

  files <packages>     - Show all files installed by packages.

  install <packages>   - Install specified packages.

  list-all             - List all packages available in repositories.

  list-installed       - List installed packages.

  reinstall <packages> - Reinstall specified installed packages at the
                         latest version.

  search <query>       - Search package by query, for example by name or
                         description part.

  show <packages>      - Show basic metadata, such as dependencies.

  uninstall <packages> - Uninstall specified packages. Configuration files
                         will be left intact.

  upgrade              - Upgrade all installed packages to the latest
                         version.

  update               - Update apt databases from configured
                         repositories.`);
                    } else if (args[1] === 'install') {
                        await fakeInstall(args[2]);
                    } else {
                         // Gestione generica
                         printToScreen("Checking for updates...");
                         await delay(500);
                         printToScreen("All packages up to date.");
                    }
                    break;

                case 'apt':
                    if (!args[1]) {
                        printToScreen(`apt 3.1.12 (aarch64)
Usage: apt [options] command

apt is a commandline package manager and provides commands for
searching and managing as well as querying information about packages.
It provides the same functionality as the specialized APT tools,
like apt-get and apt-cache, but enables options more suitable for
interactive use by default.

Most used commands:
  list - list packages based on package names
  search - search in package descriptions
  show - show package details
  install - install packages
  reinstall - reinstall packages
  remove - remove packages
  autoremove - automatically remove all unused packages
  update - update list of available packages
  upgrade - upgrade the system by installing/upgrading packages
  full-upgrade - upgrade the system by removing/installing/upgrading packages
  history-list - show list of history
  history-info - show info on specific transactions
  history-redo - redo transactions
  history-undo - undo transactions
  history-rollback - rollback transactions
  edit-sources - edit the source information file
  modernize-sources - modernize .list files to .sources files
  satisfy - satisfy dependency strings
  why - produce a reason trace for the current state of the package
  why-not - produce a reason trace for the current state of the package

See apt(8) for more information about the available commands.
Configuration options and syntax is detailed in apt.conf(5).
Information about how to configure sources can be found in sources.list(5).
Package and version choices can be expressed via apt_preferences(5).
Security details are available in apt-secure(8).
                                        This APT has Super Cow Powers.`);
                    } else if (args[1] === 'update') {
                        printToScreen("Get:1 https://termux.net stable InRelease [14.0 kB]");
                        await delay(300);
                        printToScreen("Get:2 https://termux.net stable/main aarch64 Packages [102 kB]");
                        await delay(300);
                        printToScreen("Fetched 116 kB in 1s (100 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done");
                    }
                    break;

                case 'update':
                case 'storage':
                    // Replica errore Bash
                    printToScreen(`bash: ${cmd}: command not found`);
                    break;

                case 'clear':
                    outputDiv.innerHTML = '';
                    break;

                case 'ls':
                    const files = fileSystem[currentDir] || [];
                    // Le cartelle in blu, file in bianco
                    let html = files.map(f => f.includes('.') ? f : `<span class="blue">${f}</span>`).join('  ');
                    printToScreen(html);
                    break;
                
                case 'pwd':
                    // Simula percorso reale termux
                    let realPath = currentDir.replace('~', '/data/data/com.termux/files/home');
                    printToScreen(realPath);
                    break;

                case 'cd':
                    if (!args[1] || args[1] === '~') {
                        currentDir = "~";
                    } else if (args[1] === '..') {
                         // Semplice logica torna indietro (non perfetta ma funzionale per demo)
                         if(currentDir !== "~") currentDir = "~";
                    } else {
                        // Entra in cartella (simulato)
                        if (fileSystem[currentDir + "/" + args[1]] || fileSystem["~/" + args[1]]) {
                            if(currentDir === "~") currentDir += "/" + args[1];
                        } else {
                            printToScreen(`bash: cd: ${args[1]}: No such file or directory`);
                        }
                    }
                    updatePrompt();
                    break;

                case 'termux-setup-storage':
                    printToScreen(`
It appears that directory '~/storage' already exists.
This script is going to rebuild its structure from
scratch, wiping all dangling files. The actual storage
content IS NOT going to be deleted.

Do you want to continue? (y/n)`);
                    interactiveState = 'storage_setup';
                    break;
                
                case 'exit':
                    printToScreen("Process completed (signal 9). Press Reload to restart.");
                    input.disabled = true;
                    break;

                default:
                    printToScreen(`bash: ${cmd}: command not found`);
            }
        }

        // --- GESTIONE INTERATTIVA (Y/N) ---
        function handleInteractive(ans) {
            const answer = ans.toLowerCase();
            
            if (interactiveState === 'storage_setup') {
                if (answer === 'y') {
                    // Simula attesa
                    setTimeout(() => {
                        // Chiede permessi veri al browser
                        let permission = confirm("Allow Termux Elking to access photos, media and files on your device?");
                        if (permission) {
                            // Se accetta, sblocca il cambio sfondo
                            let bgInput = document.createElement('input');
                            bgInput.type = 'file';
                            bgInput.accept = 'image/*';
                            bgInput.onchange = (e) => {
                                const file = e.target.files[0];
                                const reader = new FileReader();
                                reader.onload = (ev) => document.body.style.backgroundImage = `url(${ev.target.result})`;
                                reader.readAsDataURL(file);
                            };
                            bgInput.click(); // Apre galleria
                            printToScreen("Storage permission granted.");
                        } else {
                            printToScreen("Permission denied.");
                        }
                        interactiveState = null;
                        promptLabel.innerText = getPrompt();
                    }, 500);
                } else {
                    printToScreen("Aborting configuration and leaving directory '~/storage' intact.");
                    interactiveState = null;
                    promptLabel.innerText = getPrompt();
                }
            }
        }

        // --- UTILITIES ---
        function getPrompt() {
            // Mantiene la cartella corrente nel prompt
            let displayDir = currentDir === "~" ? "~" : currentDir.split('/').pop();
            return `H4CK3R[${displayDir}]:#`;
        }

        function updatePrompt() {
            promptLabel.innerText = getPrompt();
        }

        function printToScreen(text) {
            const div = document.createElement('div');
            div.className = 'output-line';
            div.innerHTML = text; // Usa innerHTML per i colori
            outputDiv.appendChild(div);
        }

        function focusInput() { input.focus(); }
        
        function scrollToBottom() {
            document.getElementById('terminal-overlay').scrollTop = document.getElementById('terminal-overlay').scrollHeight;
        }

        function insert(char) {
            if(char.length > 1 && char !== 'ESC') return; // Gestione tasti non char
            input.value += char;
            input.focus();
        }

        function zoom(dir) {
            currentZoom += dir;
            root.style.setProperty('--font-size', currentZoom + 'px');
        }

        function delay(ms) { return new Promise(res => setTimeout(res, ms)); }

        // Simulazione Installazione
        async function fakeInstall(pkg) {
            if(!pkg) { printToScreen("E: Missign package name."); return; }
            printToScreen(`Checking dependencies for ${pkg}...`);
            await delay(400);
            printToScreen(`Downloading ${pkg} (100%)...`);
            
            let bar = "";
            let pDiv = document.createElement('div');
            pDiv.className = 'output-line';
            outputDiv.appendChild(pDiv);
            
            for(let i=0; i<=20; i++) {
                pDiv.innerText = `Setting up ${pkg} [${"#".repeat(i)}${".".repeat(20-i)}]`;
                await delay(50 + Math.random()*100);
            }
            printToScreen("");
            printToScreen(`Package ${pkg} installed.`);
        }

    </script>
</body>
</html>

